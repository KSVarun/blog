---
title: "Posture detection system with OpenCV and MediaPipe"
date: "2nd November, 2024"
meta:
  title: "Posture detection system with OpenCV and MediaPipe"
  description: "Prolonged sitting and poor posture can lead to serious health issues. This post explores how to build a real-time posture detection system using OpenCV and MediaPipe to promote better posture and overall well-being."
---

# {attributes.title}

{attributes.date}

<br />
<br />

## Understanding the concept

Our goal is to use computer vision to detect a personâ€™s posture and determine whether they are sitting upright or slouching. We achieve this by

- Capturing frames from the webcam.
- Using MediaPipe's Pose Detection model to identify key body landmarks.
- Calculating the angle between the **shoulders** and the **nose** to determine the posture.
- Alerting the user with a sound if poor posture is detected consistently.

<div
  style={{
    background: "gainsboro",
    padding: "1px 25px 1px 25px",
    borderRadius: "10px",
    fontWeight: 600,
  }}
>
  _Before we dive in to the code, we need to be mindful about the security and
  privacy, since we are using webcam to detect the posture, other applications
  who have access to webcam can make use of it, we have to check the necessary
  permissions of the webcam to make sure we are safe._
</div>

<br />

## Prerequisites

Before we dive into the code, make sure you have the following installed, using <a href="https://docs.python.org/3/library/venv.html" target="_blank">venv</a> is highly recommended

- Python (version 3.6+)
- OpenCV (pip install opencv-python)
- MediaPipe (pip install mediapipe)
- Numpy (pip install numpy)

## Step-by-Step implementation

Let's break down the implementation into manageable parts.

### 1. Importing libraries

```python
import cv2
import mediapipe as mp
import numpy as np
```

Let's begin by importing the necessary libraries

- OpenCV for capturing video and processing frames.
- MediaPipe for pose detection.
- Numpy for mathematical operations.

### 2. Initialize MediaPipe pose

```python
mp_pose = mp.solutions.pose
pose = mp_pose.Pose(static_image_mode=False, model_complexity=0, enable_segmentation=False, min_detection_confidence=0.5)
mp_drawing = mp.solutions.drawing_utils
```

Here, we set up the MediaPipe Pose object with the desired configurations. Keeping in mind the memory consumption the configurations used here does not bring out complete features of MediaPipe,
even with this I was able to produce accurate results every time.

- **static_image_mode=False**: For video input.
- **model_complexity=0**: A simpler model to save computation resources.
- **enable_segmentation=False**: Disables segmentation to reduce processing time.
- **min_detection_confidence=0.5**: Only landmarks detected with at least 50% confidence are used.

### 3. Define angle calculation

```python
def calculate_angle(a, b, c):
    a = np.array(a)
    b = np.array(b)
    c = np.array(c)
    radians = np.arctan2(c[1] - b[1], c[0] - b[0]) - np.arctan2(a[1] - b[1], a[0] - b[0])
    angle = np.abs(radians * 180.0 / np.pi)
    if angle > 180.0:
        angle = 360 - angle
    return angle
```

**calculate_angle** function computes the angle between three points (in 2D space) to check the posture. The first three lines of the function converts the points to NumPy arrays for easier mathematical calculations,
in the next two lines we use trigonometry (<a href="https://numpy.org/doc/2.0/reference/generated/numpy.arctan2.html#numpy.arctan2" target="_blank">arctan2</a>) to calculate the angle in radians and converts it to degrees and finally we adjust the angle to always be between 0 and 180 degrees.

The angle should be between 0 and 180 degrees because it represents the measurement between two vectors formed by three points (in our case, the coordinates of body landmarks like shoulders and nose).
When calculating angles using vectors, the output can range from 0 to 360 degrees. However, in the context of posture detection, angles greater than 180 degrees don't make physical sense for evaluating the alignment of the body. A posture angle will always be in the range of 0 to 180 degrees since the human body cannot naturally fold backward beyond 180 degrees in this scenario.

Also limiting the angle to a 0-180 degree range simplifies the analysis and interpretation of the posture. If the angle exceeds 180 degrees, we take the complement (360 - angle) to ensure we're measuring the smaller angle between the two vectors, which is more relevant for posture assessment.

Hence, by keeping the angle between 0 and 180 degrees, we can accurately determine whether someone is slouching or sitting straight.
